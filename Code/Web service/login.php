<?php
session_start();include_once('/home/www-data/config/config.php');include_once('/home/www-data/function/function.php');include_once('/home/www-data/database/sqlite.php');error_reporting(E_ERROR | E_WARNING | E_PARSE);$sql = new MyDB('/home/www-data/database/smarthome.db');if (!var_set($_GET['action'])) echo file_get_contents('/home/www-data/template/login.tpl');switch ($_GET['action']) {	case 'login':		$username = sql_filter($_POST['username']);		$password = md5($_POST['password']);				$query = $sql->setquery('SELECT * FROM "users" WHERE "username" = "'.$username.'" AND "password" = "'.$password.'"');		$result = $query->fetchArray(SQLITE3_ASSOC);				if ($result === false) echo '';		else {			$_SESSION['login'] = true;			$_SESSION['username'] = $result['username'];			$_SESSION['real_name'] = $result['real_name'];						$sql->setquery('UPDATE "users" SET "last_login" = "'.current_time().'" WHERE "id" = "'.$result['id'].'"');			echo 'DONE';		}		break;	case 'logout':		if ($_SESSION['login'] == false) echo 'Bạn chưa đăng nhập !';		else {			unset($_SESSION['login']);			unset($_SESSION['username']);			unset($_SESSION['real_name']);			echo 'DONE';		}		break;			default: 		if ($_SESSION['login'] == true) header('Location: index.php');		break;}$sql->close();?>